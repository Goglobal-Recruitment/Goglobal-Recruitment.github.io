<script>
  function parseCSV(text) {
    const rows = text.trim().split('\n');
    const cleanHeader = h => h.replace(/^\uFEFF/, '').trim(); // Remove BOM if present
    const headers = rows[0].split(';').map(cleanHeader); // <-- Changed to semicolon
    return rows.slice(1).map(line => {
      const vals = line.split(';').map(v => v.trim());  // <-- Also changed to semicolon
      const entry = {};
      headers.forEach((h, i) => entry[h] = vals[i] || '');
      return entry;
    });
  }

  function formatStatus(val) {
    if (!val || val.toLowerCase() === 'no') return '<span class="status-red">❌ No</span>';
    const low = val.toLowerCase();
    if (['yes', 'complete', 'completed', 'booked', 'scheduled'].includes(low))
      return '<span class="status-green">✅ ' + val + '</span>';
    return '<span class="status-orange">⏳ ' + val + '</span>';
  }

  async function checkProgress() {
    const login = document.getElementById('loginNumber').value.trim().toUpperCase();
    const resultDiv = document.getElementById('progress-result');
    resultDiv.innerHTML = 'Loading...';

    if (!login) {
      resultDiv.innerHTML = '<p style="color:red;">Please enter a client number.</p>';
      return;
    }

    try {
      const res = await fetch(
        'https://raw.githubusercontent.com/Goglobal-Recruitment/Goglobal-Recruitment.github.io/main/fixed_data.csv'
      );
      const txt = await res.text();
      const data = parseCSV(txt);
      const client = data.find(c => c['Client Number']?.trim().toUpperCase() === login);

      if (!client) {
        resultDiv.innerHTML = '<p style="color:red;">Client number not found. Please check and try again.</p>';
        return;
      }

      resultDiv.innerHTML = `
        <h4>Status for ${login}</h4>
        <p><strong>Email:</strong> interviewsglo@outlook.com</p>
        <ul>
          <li>CV Uploaded:<span>${formatStatus(client['CV Uploaded'])}</span></li>
          <li>Offer Letter:<span>${formatStatus(client['Offer Letter'])}</span></li>
          <li>Service Agreement:<span>${formatStatus(client['Go-Global Service Agreement'])}</span></li>
          <li>Employment Contract:<span>${formatStatus(client['Employment Contract'])}</span></li>
          <li>Debtform/Schedule:<span>${formatStatus(client['Debtform/Schedule'])}</span></li>
          <li>Client Service Booking:<span>${formatStatus(client['Client Service booking'])}</span></li>
          <li>Biometrics Booking:<span>${formatStatus(client['Biometrics Booking'])}</span></li>
          <li>Medical Booked:<span>${formatStatus(client['Medical Booked'])}</span></li>
          <li>Psychologist Booking:<span>${formatStatus(client['Psychologist Booking'])}</span></li>
          <li>Elites Test Booking:<span>${formatStatus(client['Elites Test Booking'])}</span></li>
          <li>Hiring Meeting:<span>${formatStatus(client['Hiring Company Meeting'])}</span></li>
          <li><strong>Final Status:</strong><span>${formatStatus(client['Final Status'])}</span></li>
        </ul>`;
    } catch (err) {
      console.error(err);
      resultDiv.innerHTML = '<p style="color:red;">Failed to load progress. Try again later.</p>';
    }
  }
</script>
