<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Tracker Debug</title>
</head>
<body>
  <h2>Tracker Debug Page</h2>
  <input id="loginNumber" placeholder="Client Number (e.g. CL005)" style="width:200px" />
  <button onclick="checkProgress()">Check</button>
  <div id="progress-result" style="margin-top:1rem;"></div>

  <script>
    async function checkProgress() {
      const login = document.getElementById('loginNumber').value.trim().toUpperCase();
      document.getElementById('progress-result').innerText = 'Loading...';
      try {
        const res = await fetch('https://raw.githubusercontent.com/goglobal-recruitment/Go-Global-Recruitment/main/cleaned_application_status.csv');
        console.log('Fetch status:', res.status);
        const txt = await res.text();
        console.log('CSV preview:', txt.slice(0,200));
        const rows = txt.trim().split('\n');
        const headers = rows[0].split(';').map(h => h.trim().replace(/^\uFEFF/, ''));
        console.log('Parsed headers:', headers);
        const data = rows.slice(1).map(line => {
          const vals = line.split(';');
          return headers.reduce((o, h, i) => (o[h] = (vals[i] || '').trim(), o), {});
        });
        console.log('Client Numbers found:', data.map(c => c['Client Number']));
        const client = data.find(c => c['Client Number'] === login);
        if (!client) {
          document.getElementById('progress-result').innerText = 'Client not found. See console for list.';
        } else {
          document.getElementById('progress-result').innerText = 'Client FOUND: ' + JSON.stringify(client);
        }
      } catch (e) {
        console.error(e);
        document.getElementById('progress-result').innerText = 'Error retrieving CSV. Check console.';
      }
    }
  </script>
</body>
</html>
